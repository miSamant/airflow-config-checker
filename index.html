<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apache Airflow Config Calculator - Beta Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f7fa;
            line-height: 1.6;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .form-section h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .calculate-btn {
            background-color: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            margin: 0 auto;
            transition: background-color 0.3s;
        }
        
        .calculate-btn:hover {
            background-color: #2980b9;
        }
        
        .results {
            margin-top: 30px;
            display: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #27ae60;
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .result-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .utilization-bars {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .utilization-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        .utilization-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .config-export {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-line;
            overflow-x: auto;
        }
        
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .results-grid {
                grid-template-columns: 1fr 1fr;
            }
            .utilization-bars {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Apache Airflow Config Calculator</h1>
        <p class="subtitle">Optimize your Airflow deployment configuration</p>
        
        <div class="form-grid">
            <div class="form-section">
                <h2>System Resources</h2>
                
                <div class="input-group">
                    <label for="airflow-version">Airflow Version</label>
                    <select id="airflow-version">
                        <option value="2.6.0">2.6.0 (stable)</option>
                        <option value="2.7.0">2.7.0 (stable)</option>
                        <option value="2.8.0" selected>2.8.0 (recommended)</option>
                        <option value="2.9.0">2.9.0 (latest)</option>
                        <option value="3.0.0">3.0.0 (beta)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="deployment-type">Deployment Type</label>
                    <select id="deployment-type">
                        <option value="standalone" selected>Standalone</option>
                        <option value="docker">Docker Compose</option>
                        <option value="kubernetes">Kubernetes</option>
                        <option value="celery">Celery Executor</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="cpu-cores">CPU Cores</label>
                    <input type="number" id="cpu-cores" value="4" min="1" max="64">
                </div>
                
                <div class="input-group">
                    <label for="ram-gb">RAM (GB)</label>
                    <input type="number" id="ram-gb" value="8" min="1" max="256">
                </div>
                
                <div class="input-group">
                    <label for="storage-gb">Storage (GB)</label>
                    <input type="number" id="storage-gb" value="100" min="10" max="1000">
                </div>
            </div>
            
            <div class="form-section">
                <h2>Workload Profile</h2>
                
                <div class="input-group">
                    <label for="expected-dags">Expected DAGs</label>
                    <input type="number" id="expected-dags" value="50" min="1" max="1000">
                </div>
                
                <div class="input-group">
                    <label for="avg-tasks">Average Tasks per DAG</label>
                    <input type="number" id="avg-tasks" value="10" min="1" max="100">
                </div>
                
                <div class="input-group">
                    <label for="concurrent-dags">Concurrent DAGs</label>
                    <input type="number" id="concurrent-dags" value="10" min="1" max="100">
                </div>
                
                <div class="input-group">
                    <label for="task-duration">Avg Task Duration (minutes)</label>
                    <input type="number" id="task-duration" value="5" min="1" max="120">
                </div>
                
                <div class="input-group">
                    <label for="dag-frequency">DAG Run Frequency</label>
                    <select id="dag-frequency">
                        <option value="hourly">Hourly</option>
                        <option value="daily" selected>Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
            </div>
        </div>
        
        <button class="calculate-btn" onclick="calculateConfig()">Calculate Optimal Configuration</button>
        
        <div class="results" id="results">
            <h2>Recommended Configuration</h2>
            
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-value" id="workers-count">-</div>
                    <div class="result-label">Workers</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="schedulers-count">-</div>
                    <div class="result-label">Schedulers</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="db-connections">-</div>
                    <div class="result-label">DB Connections</div>
                </div>
                <div class="result-card">
                    <div class="result-value" id="peak-tasks">-</div>
                    <div class="result-label">Peak Tasks</div>
                </div>
            </div>
            
            <div class="utilization-bars">
                <div class="utilization-item">
                    <div class="utilization-label">
                        <span>CPU Utilization</span>
                        <span id="cpu-percent">-</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cpu-bar"></div>
                    </div>
                </div>
                <div class="utilization-item">
                    <div class="utilization-label">
                        <span>RAM Utilization</span>
                        <span id="ram-percent">-</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="ram-bar"></div>
                    </div>
                </div>
            </div>
            
            <div id="warnings"></div>
            
            <h3>Configuration Export</h3>
            <div class="config-export" id="config-export"></div>
        </div>
    </div>

    <script>
        function calculateConfig() {
            // Get input values
            const version = document.getElementById('airflow-version').value;
            const deploymentType = document.getElementById('deployment-type').value;
            const cpu = parseInt(document.getElementById('cpu-cores').value) || 4;
            const ram = parseInt(document.getElementById('ram-gb').value) || 8;
            const storage = parseInt(document.getElementById('storage-gb').value) || 100;
            const expectedDAGs = parseInt(document.getElementById('expected-dags').value) || 50;
            const avgTasks = parseInt(document.getElementById('avg-tasks').value) || 10;
            const concurrentDAGs = parseInt(document.getElementById('concurrent-dags').value) || 10;
            const taskDuration = parseInt(document.getElementById('task-duration').value) || 5;
            
            // Calculate optimal configuration
            const totalTasks = expectedDAGs * avgTasks;
            const peakConcurrentTasks = Math.min(concurrentDAGs * avgTasks, totalTasks * 0.3);
            
            // Worker calculation
            let recommendedWorkers = Math.max(2, Math.ceil(peakConcurrentTasks / 4));
            const maxWorkersByCPU = Math.floor(cpu / 0.5);
            const maxWorkersByRAM = Math.floor(ram / 1);
            recommendedWorkers = Math.min(recommendedWorkers, maxWorkersByCPU, maxWorkersByRAM);
            
            // Scheduler calculation
            let recommendedSchedulers = deploymentType === 'kubernetes' ? 
                Math.max(2, Math.ceil(expectedDAGs / 100)) : 1;
            
            // Database connections
            const dbConnections = Math.max(20, recommendedWorkers * 5 + recommendedSchedulers * 10);
            
            // Resource utilization
            const cpuUtilization = ((recommendedWorkers * 0.5 + recommendedSchedulers * 1) / cpu * 100);
            const ramUtilization = ((recommendedWorkers * 1 + recommendedSchedulers * 2) / ram * 100);
            
            // Update results
            document.getElementById('workers-count').textContent = recommendedWorkers;
            document.getElementById('schedulers-count').textContent = recommendedSchedulers;
            document.getElementById('db-connections').textContent = dbConnections;
            document.getElementById('peak-tasks').textContent = Math.ceil(peakConcurrentTasks);
            
            // Update utilization bars
            updateUtilizationBar('cpu', cpuUtilization);
            updateUtilizationBar('ram', ramUtilization);
            
            // Generate warnings
            generateWarnings(cpuUtilization, ramUtilization, recommendedWorkers, expectedDAGs, deploymentType, peakConcurrentTasks);
            
            // Generate config export
            generateConfigExport(version, deploymentType, cpu, ram, storage, recommendedWorkers, 
                recommendedSchedulers, dbConnections, avgTasks, concurrentDAGs, expectedDAGs);
            
            // Show results
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        function updateUtilizationBar(type, percentage) {
            const percent = Math.min(Math.max(percentage, 0), 100);
            const bar = document.getElementById(type + '-bar');
            const label = document.getElementById(type + '-percent');
            
            label.textContent = percent.toFixed(1) + '%';
            bar.style.width = percent + '%';
            
            // Color coding
            if (percent > 85) {
                bar.style.backgroundColor = '#e74c3c';
            } else if (percent > 70) {
                bar.style.backgroundColor = '#f39c12';
            } else {
                bar.style.backgroundColor = '#27ae60';
            }
        }
        
        function generateWarnings(cpuUtil, ramUtil, workers, dags, deployment, peakTasks) {
            const warnings = [];
            
            if (cpuUtil > 90) {
                warnings.push('⚠️ CPU utilization is very high. Consider adding more CPU cores or reducing concurrent tasks.');
            }
            
            if (ramUtil > 85) {
                warnings.push('⚠️ Memory utilization is high. Consider increasing RAM allocation.');
            }
            
            if (workers < 2) {
                warnings.push('ℹ️ Low worker count may create bottlenecks for parallel task execution.');
            }
            
            if (dags > 200 && deployment === 'standalone') {
                warnings.push('⚠️ High DAG count detected. Consider Kubernetes deployment for better scalability.');
            }
            
            if (peakTasks > workers * 4) {
                warnings.push('⚠️ Peak concurrent tasks may exceed worker capacity. Tasks will queue.');
            }
            
            const warningsDiv = document.getElementById('warnings');
            if (warnings.length > 0) {
                warningsDiv.innerHTML = warnings.map(w => `<div class="warning">${w}</div>`).join('');
            } else {
                warningsDiv.innerHTML = '';
            }
        }
        
        function generateConfigExport(version, deployment, cpu, ram, storage, workers, schedulers, dbConnections, avgTasks, concurrentDAGs, expectedDAGs) {
            const executor = deployment === 'kubernetes' ? 'KubernetesExecutor' : 'CeleryExecutor';
            const maxActiveRuns = Math.ceil(concurrentDAGs / expectedDAGs * 16);
            const parallelism = workers * 4;
            const poolSize = Math.ceil(dbConnections / 2);
            const maxOverflow = Math.ceil(dbConnections / 4);
            
            const config = `# Recommended Airflow Configuration
# Version: ${version}
# Deployment: ${deployment}

# Resources
CPU_CORES = ${cpu}
MEMORY_GB = ${ram}
STORAGE_GB = ${storage}

# Airflow Settings
AIRFLOW_VERSION = "${version}"
AIRFLOW__CORE__EXECUTOR = "${executor}"
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG = ${avgTasks}
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG = ${maxActiveRuns}
AIRFLOW__CORE__PARALLELISM = ${parallelism}
AIRFLOW__CELERY__WORKER_CONCURRENCY = 4
AIRFLOW__CORE__SQL_ALCHEMY_POOL_SIZE = ${poolSize}
AIRFLOW__CORE__SQL_ALCHEMY_MAX_OVERFLOW = ${maxOverflow}

# Recommended Setup
WORKERS = ${workers}
SCHEDULERS = ${schedulers}
DB_CONNECTIONS = ${dbConnections}

# Docker Compose Example (if using Docker)
# services:
#   airflow-scheduler:
#     cpus: '${schedulers}'
#     mem_limit: ${schedulers * 2}g
#   
#   airflow-worker:
#     deploy:
#       replicas: ${workers}
#     cpus: '0.5'
#     mem_limit: 1g`;
            
            document.getElementById('config-export').textContent = config;
        }
    </script>
</body>
</html>
